
name: YamDB Django-app
on: push

jobs:
  build_and_push_to_docker_hub:
      name: Загрузка docker образа на DockerHub
      runs-on: ubuntu-latest
      needs: tests
      steps:
        - name: Проверка доступа репозитория DockerHub
          uses: actions/checkout@v3 
        
        - name: Вызов сборщика контейнеров docker
          uses: docker/setup-buildx-action@v2

        - name: Авторизации на DockerHub
          uses: docker/login-action@v2 
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}
        
        - name: Загрузка образа в DockerHub
          # run: docker push v1ncento/yamdb_final:latest
          uses: docker/build-push-action@v3 
          with:
            push: true
            tags: v1ncento/yamdbfinal:latest
  # deploy:
  #   name: Deploy
  #   runs-on: ubuntu-latest
  #   needs: build_and_push_to_docker_hub
  #   steps:
  #   - name: Выполнение удаленных ssh-команд для развертывания
  #     uses: appleboy/ssh-action@master
  #     with:
  #       host: ${{ secrets.HOST }}
  #       username: ${{ secrets.USER }}
  #       key: ${{ secrets.SSH_KEY }}
  #       script: |
  #         sudo docker pull v1ncento/yamdbfinal:latest
  #         sudo docker container stop $(sudo docker ps -aq)
  #         sudo docker run --rm -d -p 5000:5000 v1ncento/yamdbfinal:latest

  # send_message:
    # name: ----> ✉
    # runs-on: ubuntu-latest
    # needs: deploy
    # steps:
    # - name: send message
    #   uses: appleboy/telegram-action@master
    #   with:
    #     to: ${{ secrets.TELEGRAM_TO }}
    #     token: ${{ secrets.TELEGRAM_TOKEN }}
    #     message: ${{ github.workflow }} успешно выполнен!